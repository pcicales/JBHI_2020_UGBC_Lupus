import h5py
import numpy as np
import os

num_classes = 5
cur_dir = os.path.dirname(os.path.abspath(__file__))
dest_dir = os.path.join(cur_dir, '5fold_data')

if not os.path.exists(dest_dir):
    os.mkdir(dest_dir)

for i in range(5):
    h5f = h5py.File('/home/cougarnet.uh.edu/pcicales/Desktop/'
                    'glomerulus_classification-master/dataset/data_5C_{}.h5'.
                    format(2*i), 'r')
    x1 = h5f['x'][:]
    y1 = h5f['y'][:]
    name1 = h5f['name'][:]

    # Label correction (temporary fix)
    for j in range(0,len(name1)):
        if name1[j] in [100720190628,100720190631,100720190633,100720190634,100720190636,100720190812,100720190816,
                        100720190819,100720190821,100720190825,100720190835,100720190828,100720190831,100720190506,
                        100720190511,100720190509,100720190513,100720190515,100720190517,100720190521,100720190523,
                        100720190757,100720190800,100720190803,100720190806,100720190407]:
            y1[j] = 0
        elif name1[j] in [100720190621,100720190624,100720190700,100720190833,100720190356,100720190519,100720190535,
                          100720190838,100720190550,100720190553,100720190559,100720190731,100720190742,100720190748,
                          100720190752,100720190432,100720190436,100720190439]:
            y1[j] = 1
        elif name1[j] in [100720190652,100720190657,100720190525,100720190808,100720190540,100720190546,100720190702,
                          100720190711,100720190727,100720190735,100720190410,100720190413,100720190443,100720190454,
                          100720190459]:
            y1[j] = 2
        elif name1[j] in [100720190614,100720190618,100720190639,100720190642,100720190527,100720190531,100720190543,
                          100720190358,100720190705,100720190707,100720190713,100720190738,100720190745,100720190404,
                          100720190416,100720190426,100720190428,100720190446,100720190503]:
            y1[j] = 3
        elif name1[j] in [100720190646,100720190649,100720190654,100720190556,100720190401,100720190717,100720190722,
                          100720190420,100720190423,100720190602,100720190605,100720190608]:
            y1[j] = 4

    # # Machine label correction
    # for j in range(0,len(name1)):
    #     if name1[j] in [100720190443, 100720190808]:
    #         y1[j] = 1
    #     elif name1[j] in [100720190705, 100720190838, 100720190731]:
    #         y1[j] = 2
    #     elif name1[j] in [100720190735, 100720190420, 100720190605, 100720190410, 100720190608]:
    #         y1[j] = 3
    #     elif name1[j] in [100720190543, 100720190413]:
    #         y1[j] = 4

    h5f.close()

    h5f = h5py.File('/home/cougarnet.uh.edu/pcicales/Desktop/'
                    'glomerulus_classification-master/dataset/data_5C_{}.h5'.
                    format(2*i+1), 'r')
    x2 = h5f['x'][:]
    y2 = h5f['y'][:]
    name2 = h5f['name'][:]

    # Label correction (temporary fix)
    for j in range(0,len(name2)):
        if name2[j] in [100720190628,100720190631,100720190633,100720190634,100720190636,100720190812,100720190816,
                        100720190819,100720190821,100720190825,100720190835,100720190828,100720190831,100720190506,
                        100720190511,100720190509,100720190513,100720190515,100720190517,100720190521,100720190523,
                        100720190757,100720190800,100720190803,100720190806,100720190407]:
            y2[j] = 0
        elif name2[j] in [100720190621,100720190624,100720190700,100720190833,100720190356,100720190519,100720190535,
                          100720190838,100720190550,100720190553,100720190559,100720190731,100720190742,100720190748,
                          100720190752,100720190432,100720190436,100720190439]:
            y2[j] = 1
        elif name2[j] in [100720190652,100720190657,100720190525,100720190808,100720190540,100720190546,100720190702,
                          100720190711,100720190727,100720190735,100720190410,100720190413,100720190443,100720190454,
                          100720190459]:
            y2[j] = 2
        elif name2[j] in [100720190614,100720190618,100720190639,100720190642,100720190527,100720190531,100720190543,
                          100720190358,100720190705,100720190707,100720190713,100720190738,100720190745,100720190404,
                          100720190416,100720190426,100720190428,100720190446,100720190503]:
            y2[j] = 3
        elif name2[j] in [100720190646,100720190649,100720190654,100720190556,100720190401,100720190717,100720190722,
                          100720190420,100720190423,100720190602,100720190605,100720190608]:
            y2[j] = 4

    # # Machine label correction
    # for j in range(0,len(name2)):
    #     if name2[j] in [100720190443, 100720190808]:
    #         y2[j] = 1
    #     elif name2[j] in [100720190705, 100720190838, 100720190731]:
    #         y2[j] = 2
    #     elif name2[j] in [100720190735, 100720190420, 100720190605, 100720190410, 100720190608]:
    #         y2[j] = 3
    #     elif name2[j] in [100720190543, 100720190413]:
    #         y2[j] = 4

    h5f.close()

    x = np.concatenate((x1, x2), axis=0)
    y = np.append(y1, y2)
    name = np.append(name1, name2)

    h5f = h5py.File(os.path.join(dest_dir, 'data_5C_{}.h5'.format(i)), 'w')
    h5f.create_dataset('x', data=x)
    h5f.create_dataset('y', data=y)
    h5f.create_dataset('name', data=name)
    h5f.close()
